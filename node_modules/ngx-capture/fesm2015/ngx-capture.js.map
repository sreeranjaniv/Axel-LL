{"version":3,"file":"ngx-capture.js","sources":["../../../projects/ngx-capture/src/lib/ngx-capture.service.ts","../../../projects/ngx-capture/src/lib/ngx-capture.component.ts","../../../projects/ngx-capture/src/lib/ngx-capture.module.ts","../../../projects/ngx-capture/src/public-api.ts","../../../projects/ngx-capture/src/ngx-capture.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport html2canvas from 'html2canvas';\r\nimport { from, Observable, of } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class NgxCaptureService {\r\n  getImage(screen: HTMLElement, fullCapture?: boolean, cropDimensions?: any): Observable<string> {\r\n    let options = {\r\n      logging: false,\r\n    };\r\n\r\n    if (!fullCapture && cropDimensions.width > 10 && cropDimensions.height > 10) {\r\n      options = { ...options, ...cropDimensions };\r\n    } else if (!fullCapture) {\r\n      return of(null);\r\n    }\r\n\r\n    return from(\r\n      html2canvas(screen, options)\r\n        .then(\r\n          (canv) => {\r\n            const img = canv.toDataURL('image/png');\r\n            return img;\r\n          },\r\n          (err) => {\r\n            throw new Error(err);\r\n          }\r\n        )\r\n        .catch((res) => {\r\n          throw new Error(res);\r\n        })\r\n    );\r\n  }\r\n\r\n  // TODO\r\n  private downloadImage(img: string) {\r\n    // this.canvas.nativeElement.src = img;\r\n    // this.downloadLink.nativeElement.href = img;\r\n    // this.downloadLink.nativeElement.download = 'test.png';\r\n    // this.downloadLink.nativeElement.click();\r\n  }\r\n}\r\n","import { Component, ElementRef, EventEmitter, Input, OnInit, Output, ViewChild } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { take, tap } from 'rxjs/operators';\r\nimport { NgxCaptureService } from './ngx-capture.service';\r\n\r\ntype Point = {\r\n  x: number;\r\n  y: number;\r\n};\r\n@Component({\r\n  selector: 'ngx-capture',\r\n  template: `\r\n    <ng-content></ng-content>\r\n    <div class=\"overlay\" #over>\r\n      <div class=\"rectangle\" #rect></div>\r\n    </div>\r\n  `,\r\n  styleUrls: ['./ngx-capture.component.scss'],\r\n})\r\nexport class NgxCaptureComponent implements OnInit {\r\n  @ViewChild('rect', { static: true }) rectangle: ElementRef;\r\n  @ViewChild('over', { static: true }) overlay: ElementRef;\r\n\r\n  @Input() target: any;\r\n\r\n  @Output() resultImage = new EventEmitter<string>();\r\n\r\n  rect: HTMLElement;\r\n  captureZone: HTMLElement;\r\n\r\n  isDrawing = false;\r\n\r\n  mouseStart: Point = { x: 0, y: 0 };\r\n\r\n  cropDimensions = {\r\n    x: 0,\r\n    y: 0,\r\n    width: 0,\r\n    height: 0,\r\n  };\r\n\r\n  destroy$ = new Subject<void>();\r\n\r\n  constructor(private captureService: NgxCaptureService) {}\r\n\r\n  ngOnInit() {\r\n    setTimeout(() => {\r\n      this.rect = this.rectangle.nativeElement;\r\n      this.captureZone = this.overlay.nativeElement;\r\n\r\n      if (!this.captureZone) {\r\n        console.warn('\"captureZone\" is not set');\r\n        return;\r\n      }\r\n\r\n      this.captureZone.onmousedown = (e) => this.startCapture(e);\r\n      this.captureZone.onmousemove = (e) => this.drawRect(e);\r\n      this.captureZone.onmouseup = () => this.endCapture();\r\n    }, 2000);\r\n  }\r\n\r\n  private startCapture(e: any) {\r\n    const mouse = this.setMousePosition(e, true);\r\n\r\n    this.isDrawing = true;\r\n\r\n    this.cropDimensions = {\r\n      x: mouse.x,\r\n      y: mouse.y,\r\n      width: 0,\r\n      height: 0,\r\n    };\r\n\r\n    this.captureZone.style.cursor = 'crosshair';\r\n  }\r\n\r\n  private drawRect(e: any) {\r\n    if (this.isDrawing) {\r\n      const mouse = this.setMousePosition(e, false);\r\n\r\n      this.cropDimensions = {\r\n        x: mouse.x - this.mouseStart.x < 0 ? mouse.x : this.mouseStart.x,\r\n        y: mouse.y - this.mouseStart.y < 0 ? mouse.y : this.mouseStart.y,\r\n        width: Math.abs(mouse.x - this.mouseStart.x),\r\n        height: Math.abs(mouse.y - this.mouseStart.y),\r\n      };\r\n      this.setRectangle();\r\n    }\r\n  }\r\n\r\n  private setMousePosition(e: any, isStart = false) {\r\n    const ev = e || window.event; // Moz || IE\r\n    const mouse: Point = { x: 0, y: 0 };\r\n\r\n    if (ev.pageX) {\r\n      // Moz\r\n      mouse.x = ev.clientX;\r\n      mouse.y = ev.clientY;\r\n    } else if (ev.clientX) {\r\n      // IE\r\n      mouse.x = ev.clientX + document.body.scrollLeft;\r\n      mouse.y = ev.clientY + document.body.scrollTop;\r\n    }\r\n\r\n    if (isStart) {\r\n      this.mouseStart.x = mouse.x;\r\n      this.mouseStart.y = mouse.y;\r\n    }\r\n\r\n    return mouse;\r\n  }\r\n\r\n  private endCapture() {\r\n    this.captureZone.style.cursor = 'default';\r\n    this.isDrawing = false;\r\n\r\n    this.captureService\r\n      .getImage(this.target, false, {\r\n        ...this.cropDimensions,\r\n        x: this.cropDimensions.x + window.scrollX,\r\n        y: this.cropDimensions.y + window.scrollY,\r\n      })\r\n      .pipe(\r\n        take(1),\r\n        tap((img) => {\r\n          this.resultImage.emit(img);\r\n        })\r\n      )\r\n      .subscribe();\r\n\r\n    this.cropDimensions = {\r\n      x: 0,\r\n      y: 0,\r\n      width: 0,\r\n      height: 0,\r\n    };\r\n    this.setRectangle();\r\n  }\r\n\r\n  private setRectangle() {\r\n    this.rect.style.left = this.cropDimensions.x + 'px';\r\n    this.rect.style.top = this.cropDimensions.y + 'px';\r\n    this.rect.style.width = this.cropDimensions.width + 'px';\r\n    this.rect.style.height = this.cropDimensions.height + 'px';\r\n  }\r\n}\r\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { NgxCaptureComponent } from './ngx-capture.component';\r\n\r\n@NgModule({\r\n  declarations: [NgxCaptureComponent],\r\n  imports: [\r\n  ],\r\n  exports: [NgxCaptureComponent],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n})\r\nexport class NgxCaptureModule { }\r\n","/*\r\n * Public API Surface of ngx-capture\r\n */\r\n\r\nexport * from './lib/ngx-capture.service';\r\nexport * from './lib/ngx-capture.component';\r\nexport * from './lib/ngx-capture.module';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}