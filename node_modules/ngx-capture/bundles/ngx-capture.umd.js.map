{"version":3,"file":"ngx-capture.umd.js","sources":["../../../projects/ngx-capture/src/lib/ngx-capture.service.ts","../../../projects/ngx-capture/src/lib/ngx-capture.component.ts","../../../projects/ngx-capture/src/lib/ngx-capture.module.ts","../../../projects/ngx-capture/src/public-api.ts","../../../projects/ngx-capture/src/ngx-capture.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport html2canvas from 'html2canvas';\r\nimport { from, Observable, of } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class NgxCaptureService {\r\n  getImage(screen: HTMLElement, fullCapture?: boolean, cropDimensions?: any): Observable<string> {\r\n    let options = {\r\n      logging: false,\r\n    };\r\n\r\n    if (!fullCapture && cropDimensions.width > 10 && cropDimensions.height > 10) {\r\n      options = { ...options, ...cropDimensions };\r\n    } else if (!fullCapture) {\r\n      return of(null);\r\n    }\r\n\r\n    return from(\r\n      html2canvas(screen, options)\r\n        .then(\r\n          (canv) => {\r\n            const img = canv.toDataURL('image/png');\r\n            return img;\r\n          },\r\n          (err) => {\r\n            throw new Error(err);\r\n          }\r\n        )\r\n        .catch((res) => {\r\n          throw new Error(res);\r\n        })\r\n    );\r\n  }\r\n\r\n  // TODO\r\n  private downloadImage(img: string) {\r\n    // this.canvas.nativeElement.src = img;\r\n    // this.downloadLink.nativeElement.href = img;\r\n    // this.downloadLink.nativeElement.download = 'test.png';\r\n    // this.downloadLink.nativeElement.click();\r\n  }\r\n}\r\n","import { Component, ElementRef, EventEmitter, Input, OnInit, Output, ViewChild } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { take, tap } from 'rxjs/operators';\r\nimport { NgxCaptureService } from './ngx-capture.service';\r\n\r\ntype Point = {\r\n  x: number;\r\n  y: number;\r\n};\r\n@Component({\r\n  selector: 'ngx-capture',\r\n  template: `\r\n    <ng-content></ng-content>\r\n    <div class=\"overlay\" #over>\r\n      <div class=\"rectangle\" #rect></div>\r\n    </div>\r\n  `,\r\n  styleUrls: ['./ngx-capture.component.scss'],\r\n})\r\nexport class NgxCaptureComponent implements OnInit {\r\n  @ViewChild('rect', { static: true }) rectangle: ElementRef;\r\n  @ViewChild('over', { static: true }) overlay: ElementRef;\r\n\r\n  @Input() target: any;\r\n\r\n  @Output() resultImage = new EventEmitter<string>();\r\n\r\n  rect: HTMLElement;\r\n  captureZone: HTMLElement;\r\n\r\n  isDrawing = false;\r\n\r\n  mouseStart: Point = { x: 0, y: 0 };\r\n\r\n  cropDimensions = {\r\n    x: 0,\r\n    y: 0,\r\n    width: 0,\r\n    height: 0,\r\n  };\r\n\r\n  destroy$ = new Subject<void>();\r\n\r\n  constructor(private captureService: NgxCaptureService) {}\r\n\r\n  ngOnInit() {\r\n    setTimeout(() => {\r\n      this.rect = this.rectangle.nativeElement;\r\n      this.captureZone = this.overlay.nativeElement;\r\n\r\n      if (!this.captureZone) {\r\n        console.warn('\"captureZone\" is not set');\r\n        return;\r\n      }\r\n\r\n      this.captureZone.onmousedown = (e) => this.startCapture(e);\r\n      this.captureZone.onmousemove = (e) => this.drawRect(e);\r\n      this.captureZone.onmouseup = () => this.endCapture();\r\n    }, 2000);\r\n  }\r\n\r\n  private startCapture(e: any) {\r\n    const mouse = this.setMousePosition(e, true);\r\n\r\n    this.isDrawing = true;\r\n\r\n    this.cropDimensions = {\r\n      x: mouse.x,\r\n      y: mouse.y,\r\n      width: 0,\r\n      height: 0,\r\n    };\r\n\r\n    this.captureZone.style.cursor = 'crosshair';\r\n  }\r\n\r\n  private drawRect(e: any) {\r\n    if (this.isDrawing) {\r\n      const mouse = this.setMousePosition(e, false);\r\n\r\n      this.cropDimensions = {\r\n        x: mouse.x - this.mouseStart.x < 0 ? mouse.x : this.mouseStart.x,\r\n        y: mouse.y - this.mouseStart.y < 0 ? mouse.y : this.mouseStart.y,\r\n        width: Math.abs(mouse.x - this.mouseStart.x),\r\n        height: Math.abs(mouse.y - this.mouseStart.y),\r\n      };\r\n      this.setRectangle();\r\n    }\r\n  }\r\n\r\n  private setMousePosition(e: any, isStart = false) {\r\n    const ev = e || window.event; // Moz || IE\r\n    const mouse: Point = { x: 0, y: 0 };\r\n\r\n    if (ev.pageX) {\r\n      // Moz\r\n      mouse.x = ev.clientX;\r\n      mouse.y = ev.clientY;\r\n    } else if (ev.clientX) {\r\n      // IE\r\n      mouse.x = ev.clientX + document.body.scrollLeft;\r\n      mouse.y = ev.clientY + document.body.scrollTop;\r\n    }\r\n\r\n    if (isStart) {\r\n      this.mouseStart.x = mouse.x;\r\n      this.mouseStart.y = mouse.y;\r\n    }\r\n\r\n    return mouse;\r\n  }\r\n\r\n  private endCapture() {\r\n    this.captureZone.style.cursor = 'default';\r\n    this.isDrawing = false;\r\n\r\n    this.captureService\r\n      .getImage(this.target, false, {\r\n        ...this.cropDimensions,\r\n        x: this.cropDimensions.x + window.scrollX,\r\n        y: this.cropDimensions.y + window.scrollY,\r\n      })\r\n      .pipe(\r\n        take(1),\r\n        tap((img) => {\r\n          this.resultImage.emit(img);\r\n        })\r\n      )\r\n      .subscribe();\r\n\r\n    this.cropDimensions = {\r\n      x: 0,\r\n      y: 0,\r\n      width: 0,\r\n      height: 0,\r\n    };\r\n    this.setRectangle();\r\n  }\r\n\r\n  private setRectangle() {\r\n    this.rect.style.left = this.cropDimensions.x + 'px';\r\n    this.rect.style.top = this.cropDimensions.y + 'px';\r\n    this.rect.style.width = this.cropDimensions.width + 'px';\r\n    this.rect.style.height = this.cropDimensions.height + 'px';\r\n  }\r\n}\r\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { NgxCaptureComponent } from './ngx-capture.component';\r\n\r\n@NgModule({\r\n  declarations: [NgxCaptureComponent],\r\n  imports: [\r\n  ],\r\n  exports: [NgxCaptureComponent],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n})\r\nexport class NgxCaptureModule { }\r\n","/*\r\n * Public API Surface of ngx-capture\r\n */\r\n\r\nexport * from './lib/ngx-capture.service';\r\nexport * from './lib/ngx-capture.component';\r\nexport * from './lib/ngx-capture.module';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["of","from","html2canvas","Injectable","EventEmitter","Subject","take","tap","Component","ViewChild","Input","Output","NgModule","CUSTOM_ELEMENTS_SCHEMA"],"mappings":"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"}